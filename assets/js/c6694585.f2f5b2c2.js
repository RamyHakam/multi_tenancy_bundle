"use strict";(globalThis.webpackChunkmulti_tenancy_bundle_docs=globalThis.webpackChunkmulti_tenancy_bundle_docs||[]).push([[995],{901(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"examples/examples","title":"Code Examples","description":"Runnable code examples for every feature of the Multi-Tenancy Bundle","source":"@site/docs/examples/examples.md","sourceDirName":"examples","slug":"/examples/","permalink":"/multi_tenancy_bundle/examples/","draft":false,"unlisted":false,"editUrl":"https://github.com/RamyHakam/multi_tenancy_bundle/tree/master/docs-site/docs/examples/examples.md","tags":[],"version":"current","frontMatter":{"title":"Code Examples","sidebar_label":"Examples","description":"Runnable code examples for every feature of the Multi-Tenancy Bundle"},"sidebar":"tutorialSidebar","previous":{"title":"Suggested Patterns for Use","permalink":"/multi_tenancy_bundle/suggestions/"},"next":{"title":"Contributing","permalink":"/multi_tenancy_bundle/contributing/contribution"}}');var s=t(4848),i=t(8453);const r={title:"Code Examples",sidebar_label:"Examples",description:"Runnable code examples for every feature of the Multi-Tenancy Bundle"},l="Code Examples",c={},d=[{value:"Quick Reference",id:"quick-reference",level:2},{value:"1. Tenant Entity Setup",id:"1-tenant-entity-setup",level:2},{value:"2. Full Bundle Configuration",id:"2-full-bundle-configuration",level:2},{value:"3. Tenant Entities",id:"3-tenant-entities",level:2},{value:"4. Database Lifecycle",id:"4-database-lifecycle",level:2},{value:"5. Tenant Migrations",id:"5-tenant-migrations",level:2},{value:"6. Tenant Resolvers",id:"6-tenant-resolvers",level:2},{value:"7. Lifecycle Events",id:"7-lifecycle-events",level:2},{value:"8. Custom Config Provider",id:"8-custom-config-provider",level:2},{value:"9. Tenant Fixtures",id:"9-tenant-fixtures",level:2},{value:"10. Tenant-Aware Cache",id:"10-tenant-aware-cache",level:2},{value:"11. Tenant Context",id:"11-tenant-context",level:2},{value:"12. Testing",id:"12-testing",level:2},{value:"13. Shared Entities",id:"13-shared-entities",level:2},{value:"14. Custom Resolver",id:"14-custom-resolver",level:2},{value:"15. Full Onboarding Flow",id:"15-full-onboarding-flow",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"code-examples",children:"Code Examples"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/tree/master/examples",children:(0,s.jsx)(n.code,{children:"examples/"})})," directory contains ",(0,s.jsx)(n.strong,{children:"15 self-contained PHP files"})," covering every feature of the bundle. Each file includes inline comments, configuration snippets, and ready-to-use code."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"#"}),(0,s.jsx)(n.th,{children:"File"}),(0,s.jsx)(n.th,{children:"Feature"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"01"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#1-tenant-entity-setup",children:(0,s.jsx)(n.code,{children:"entity-setup.php"})})}),(0,s.jsxs)(n.td,{children:["Tenant config entity with ",(0,s.jsx)(n.code,{children:"TenantDbConfigTrait"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"02"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#2-full-bundle-configuration",children:(0,s.jsx)(n.code,{children:"bundle-configuration.php"})})}),(0,s.jsx)(n.td,{children:"Complete YAML config reference"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"03"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#3-tenant-entities",children:(0,s.jsx)(n.code,{children:"tenant-entities.php"})})}),(0,s.jsx)(n.td,{children:"Tenant-scoped entities (Product, Order)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"04"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#4-database-lifecycle",children:(0,s.jsx)(n.code,{children:"database-lifecycle.php"})})}),(0,s.jsx)(n.td,{children:"Create DB, switch, CRUD, list/filter"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"05"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#5-tenant-migrations",children:(0,s.jsx)(n.code,{children:"tenant-migrations.php"})})}),(0,s.jsx)(n.td,{children:"Platform-agnostic migrations"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"06"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#6-tenant-resolvers",children:(0,s.jsx)(n.code,{children:"resolvers.php"})})}),(0,s.jsx)(n.td,{children:"All 5 resolver strategies"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"07"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#7-lifecycle-events",children:(0,s.jsx)(n.code,{children:"events.php"})})}),(0,s.jsx)(n.td,{children:"All 6 lifecycle event subscribers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"08"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#8-custom-config-provider",children:(0,s.jsx)(n.code,{children:"custom-config-provider.php"})})}),(0,s.jsx)(n.td,{children:"Redis, static, in-memory providers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"09"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#9-tenant-fixtures",children:(0,s.jsx)(n.code,{children:"tenant-fixtures.php"})})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"#[TenantFixture]"})," attribute + CLI"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"10"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#10-tenant-aware-cache",children:(0,s.jsx)(n.code,{children:"tenant-aware-cache.php"})})}),(0,s.jsx)(n.td,{children:"Cache isolation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"11"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#11-tenant-context",children:(0,s.jsx)(n.code,{children:"tenant-context.php"})})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"TenantContextInterface"})," usage"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"12"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#12-testing",children:(0,s.jsx)(n.code,{children:"testing.php"})})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"TenantTestTrait"})," patterns"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"13"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#13-shared-entities",children:(0,s.jsx)(n.code,{children:"shared-entities.php"})})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"#[TenantShared]"})," attribute"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"14"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#14-custom-resolver",children:(0,s.jsx)(n.code,{children:"custom-resolver.php"})})}),(0,s.jsx)(n.td,{children:"JWT, query param, API key resolvers"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"15"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"#15-full-onboarding-flow",children:(0,s.jsx)(n.code,{children:"full-onboarding-flow.php"})})}),(0,s.jsx)(n.td,{children:"End-to-end tenant onboarding service"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"1-tenant-entity-setup",children:"1. Tenant Entity Setup"}),"\n",(0,s.jsxs)(n.p,{children:["Your application needs an entity that stores the connection details for each tenant database. Use ",(0,s.jsx)(n.code,{children:"TenantDbConfigTrait"})," for the standard fields and implement ",(0,s.jsx)(n.code,{children:"TenantDbConfigurationInterface"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Doctrine\\ORM\\Mapping as ORM;\nuse Hakam\\MultiTenancyBundle\\Services\\TenantDbConfigurationInterface;\nuse Hakam\\MultiTenancyBundle\\Traits\\TenantDbConfigTrait;\n\n#[ORM\\Entity]\n#[ORM\\Table(name: 'tenant_db_config')]\nclass TenantDbConfig implements TenantDbConfigurationInterface\n{\n    use TenantDbConfigTrait;\n\n    #[ORM\\Id]\n    #[ORM\\GeneratedValue]\n    #[ORM\\Column(type: 'integer')]\n    private ?int $id = null;\n\n    // IMPORTANT: PHP method names are case-insensitive.\n    // The trait defines getDbUserName() and the interface defines getDbUsername().\n    // Access the property directly to avoid infinite recursion.\n    public function getDbUsername(): ?string\n    {\n        return $this->dbUserName;\n    }\n\n    public function getIdentifierValue(): mixed\n    {\n        return $this->id;\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/01-entity-setup.php",children:(0,s.jsx)(n.code,{children:"examples/01-entity-setup.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-full-bundle-configuration",children:"2. Full Bundle Configuration"}),"\n",(0,s.jsx)(n.p,{children:"The complete YAML configuration with every available option:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"hakam_multi_tenancy:\n    tenant_database_className: App\\Entity\\TenantDbConfig\n    tenant_database_identifier: id\n\n    tenant_connection:\n        url: '%env(DATABASE_URL)%'\n        host: '127.0.0.1'\n        port: '3306'\n        driver: pdo_mysql\n        charset: utf8\n        server_version: '8.0'\n\n    tenant_migration:\n        tenant_migration_namespace: DoctrineMigrations\\Tenant\n        tenant_migration_path: '%kernel.project_dir%/migrations/Tenant'\n\n    tenant_entity_manager:\n        tenant_naming_strategy: doctrine.orm.naming_strategy.default\n        mapping:\n            type: attribute\n            dir: '%kernel.project_dir%/src/Entity/Tenant'\n            prefix: App\\Entity\\Tenant\n            alias: Tenant\n            is_bundle: false\n\n    resolver:\n        enabled: true\n        strategy: header\n        throw_on_missing: false\n        excluded_paths: ['/health', '/api/public', '/_profiler']\n        options:\n            header_name: X-Tenant-ID\n\n    cache:\n        enabled: true\n        prefix_separator: '__'\n\n    # Optional: custom provider override\n    # tenant_config_provider: app.my_custom_tenant_provider\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/02-bundle-configuration.php",children:(0,s.jsx)(n.code,{children:"examples/02-bundle-configuration.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-tenant-entities",children:"3. Tenant Entities"}),"\n",(0,s.jsxs)(n.p,{children:["Tenant entities live in a separate directory (e.g., ",(0,s.jsx)(n.code,{children:"src/Entity/Tenant/"}),") and are managed by the tenant entity manager:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace App\\Entity\\Tenant;\n\nuse Doctrine\\ORM\\Mapping as ORM;\n\n#[ORM\\Entity]\n#[ORM\\Table(name: 'product')]\nclass Product\n{\n    #[ORM\\Id]\n    #[ORM\\GeneratedValue]\n    #[ORM\\Column(type: 'integer')]\n    private ?int $id = null;\n\n    #[ORM\\Column(type: 'string', length: 255)]\n    private string $name = '';\n\n    #[ORM\\Column(type: 'decimal', precision: 10, scale: 2)]\n    private string $price = '0.00';\n\n    // ...getters/setters\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/03-tenant-entities.php",children:(0,s.jsx)(n.code,{children:"examples/03-tenant-entities.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4-database-lifecycle",children:"4. Database Lifecycle"}),"\n",(0,s.jsx)(n.p,{children:"The full lifecycle: register tenant, create database, switch connection, CRUD operations."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Register a new tenant\n$tenantDto = $this->tenantManager->addNewTenantDbConfig(\n    TenantConnectionConfigDTO::fromArgs(\n        identifier: null,\n        driver: DriverTypeEnum::MYSQL,\n        dbStatus: DatabaseStatusEnum::DATABASE_NOT_CREATED,\n        host: '127.0.0.1', port: 3306,\n        dbname: 'tenant_acme', user: 'root', password: 'secret',\n    )\n);\n\n// Create the database\n$this->tenantManager->createTenantDatabase($tenantDto);\n\n// Switch to it\n$this->dispatcher->dispatch(new SwitchDbEvent((string) $tenantDto->identifier));\n\n// CRUD with the tenant entity manager\n$product = new Product();\n$product->setName('Widget Pro');\n$this->tenantEntityManager->persist($product);\n$this->tenantEntityManager->flush();\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"CLI commands:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"php bin/console tenant:database:create --dbid=42     # Single tenant\nphp bin/console tenant:database:create --all          # All missing\nphp bin/console tenant:migrations:migrate init 42     # Migrate one\nphp bin/console tenant:migrations:migrate init        # Migrate all new\nphp bin/console tenant:migrations:migrate update      # Update existing\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/04-database-lifecycle.php",children:(0,s.jsx)(n.code,{children:"examples/04-database-lifecycle.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"5-tenant-migrations",children:"5. Tenant Migrations"}),"\n",(0,s.jsx)(n.p,{children:"Use Doctrine's Schema API for platform-agnostic migrations (works on MySQL and PostgreSQL):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"namespace DoctrineMigrations\\Tenant;\n\nuse Doctrine\\DBAL\\Schema\\Schema;\nuse Doctrine\\Migrations\\AbstractMigration;\n\nfinal class Version20240101000000 extends AbstractMigration\n{\n    public function up(Schema $schema): void\n    {\n        $table = $schema->createTable('product');\n        $table->addColumn('id', 'integer', ['autoincrement' => true]);\n        $table->addColumn('name', 'string', ['length' => 255]);\n        $table->addColumn('price', 'decimal', ['precision' => 10, 'scale' => 2]);\n        $table->setPrimaryKey(['id']);\n    }\n\n    public function down(Schema $schema): void\n    {\n        $schema->dropTable('product');\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/05-tenant-migrations.php",children:(0,s.jsx)(n.code,{children:"examples/05-tenant-migrations.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"6-tenant-resolvers",children:"6. Tenant Resolvers"}),"\n",(0,s.jsx)(n.p,{children:"Five built-in strategies for automatic tenant resolution from HTTP requests:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Header (APIs)\nresolver: { enabled: true, strategy: header }\n\n# Subdomain (SaaS)\nresolver: { enabled: true, strategy: subdomain, options: { base_domain: example.com } }\n\n# Path (/tenant-id/page)\nresolver: { enabled: true, strategy: path }\n\n# Host mapping (custom domains)\nresolver: { enabled: true, strategy: host, options: { host_map: { client.com: tenant1 } } }\n\n# Chain (fallback)\nresolver: { enabled: true, strategy: chain, options: { chain_order: [header, path] } }\n"})}),"\n",(0,s.jsx)(n.p,{children:"With resolvers enabled, controllers need no manual switching:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class ProductController extends AbstractController\n{\n    public function list(TenantContextInterface $tenantContext): JsonResponse\n    {\n        // Resolver already switched the DB! Just query.\n        $tenantId = $tenantContext->getTenantId();\n        $products = $this->tenantEntityManager->getRepository(Product::class)->findAll();\n        return new JsonResponse(['tenant' => $tenantId, 'count' => count($products)]);\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/06-resolvers.php",children:(0,s.jsx)(n.code,{children:"examples/06-resolvers.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"7-lifecycle-events",children:"7. Lifecycle Events"}),"\n",(0,s.jsx)(n.p,{children:"Subscribe to events fired during tenant operations:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class TenantLifecycleSubscriber implements EventSubscriberInterface\n{\n    public static function getSubscribedEvents(): array\n    {\n        return [\n            TenantCreatedEvent::class     => 'onCreated',   // DB created\n            TenantMigratedEvent::class    => 'onMigrated',  // Migrations applied\n            TenantBootstrappedEvent::class=> 'onBootstrapped', // Fixtures loaded\n            TenantSwitchedEvent::class    => 'onSwitched',  // Connection switched\n            TenantDeletedEvent::class     => 'onDeleted',   // DB dropped\n        ];\n    }\n\n    public function onCreated(TenantCreatedEvent $event): void\n    {\n        // $event->getDatabaseName(), $event->getTenantIdentifier()\n    }\n\n    public function onMigrated(TenantMigratedEvent $event): void\n    {\n        // $event->getMigrationType() \u2014 'init' or 'update'\n        // $event->isInitialMigration(), $event->getToVersion()\n    }\n\n    public function onSwitched(TenantSwitchedEvent $event): void\n    {\n        // $event->getPreviousTenantIdentifier(), $event->hadPreviousTenant()\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/07-events.php",children:(0,s.jsx)(n.code,{children:"examples/07-events.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"8-custom-config-provider",children:"8. Custom Config Provider"}),"\n",(0,s.jsx)(n.p,{children:"Replace the default Doctrine-based provider with your own:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Hakam\\MultiTenancyBundle\\Port\\TenantConfigProviderInterface;\n\nclass RedisTenantConfigProvider implements TenantConfigProviderInterface\n{\n    public function getTenantConnectionConfig(mixed $identifier): TenantConnectionConfigDTO\n    {\n        $data = $this->redis->hGetAll(\"tenant:{$identifier}\");\n        return TenantConnectionConfigDTO::fromArgs(\n            identifier: $identifier,\n            driver: DriverTypeEnum::from($data['driver']),\n            dbStatus: DatabaseStatusEnum::from($data['status']),\n            host: $data['host'], port: (int) $data['port'],\n            dbname: $data['dbname'], user: $data['user'],\n            password: $data['password'],\n        );\n    }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# config/packages/hakam_multi_tenancy.yaml\nhakam_multi_tenancy:\n    tenant_config_provider: App\\Service\\RedisTenantConfigProvider\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/08-custom-config-provider.php",children:(0,s.jsx)(n.code,{children:"examples/08-custom-config-provider.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"9-tenant-fixtures",children:"9. Tenant Fixtures"}),"\n",(0,s.jsxs)(n.p,{children:["Mark fixtures with ",(0,s.jsx)(n.code,{children:"#[TenantFixture]"})," to load them into tenant databases:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Hakam\\MultiTenancyBundle\\Attribute\\TenantFixture;\nuse Doctrine\\Bundle\\FixturesBundle\\Fixture;\n\n#[TenantFixture]\nclass ProductFixture extends Fixture\n{\n    public function load(ObjectManager $manager): void\n    {\n        $product = new Product();\n        $product->setName('Basic Plan');\n        $product->setPrice('9.99');\n        $manager->persist($product);\n        $manager->flush();\n    }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"php bin/console tenant:fixtures:load 42            # Specific tenant\nphp bin/console tenant:fixtures:load --append      # All, without purging\nphp bin/console tenant:fixtures:load --group=demo  # By group\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/09-tenant-fixtures.php",children:(0,s.jsx)(n.code,{children:"examples/09-tenant-fixtures.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"10-tenant-aware-cache",children:"10. Tenant-Aware Cache"}),"\n",(0,s.jsx)(n.p,{children:"Enable cache isolation to prefix keys with the active tenant ID automatically:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"hakam_multi_tenancy:\n    cache:\n        enabled: true\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'class ProductCatalogService\n{\n    public function getCatalog(CacheInterface $cache): array\n    {\n        // Key "product_catalog" becomes "42__product_catalog" for tenant 42\n        return $cache->get(\'product_catalog\', fn() => $this->buildCatalog());\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/10-tenant-aware-cache.php",children:(0,s.jsx)(n.code,{children:"examples/10-tenant-aware-cache.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"11-tenant-context",children:"11. Tenant Context"}),"\n",(0,s.jsxs)(n.p,{children:["Access the current tenant ID anywhere via ",(0,s.jsx)(n.code,{children:"TenantContextInterface"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class AuditService\n{\n    public function __construct(private TenantContextInterface $tenantContext) {}\n\n    public function log(string $action): void\n    {\n        $tenantId = $this->tenantContext->getTenantId(); // null if no tenant active\n        $this->logger->info($action, ['tenant' => $tenantId]);\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/11-tenant-context.php",children:(0,s.jsx)(n.code,{children:"examples/11-tenant-context.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"12-testing",children:"12. Testing"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"TenantTestTrait"})," for PHPUnit tests:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Hakam\\MultiTenancyBundle\\Test\\TenantTestTrait;\n\nclass ProductServiceTest extends KernelTestCase\n{\n    use TenantTestTrait;\n\n    public function testTenantIsolation(): void\n    {\n        // runInTenant() switches, runs callback, resets state automatically\n        $this->runInTenant('tenant_a', function () {\n            $em = $this->getTenantEntityManager();\n            $product = new Product();\n            $product->setName('Tenant A Product');\n            $em->persist($product);\n            $em->flush();\n        });\n\n        $this->runInTenant('tenant_b', function () {\n            $products = $this->getTenantEntityManager()\n                ->getRepository(Product::class)->findAll();\n            $this->assertCount(0, $products); // Isolated!\n        });\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/12-testing.php",children:(0,s.jsx)(n.code,{children:"examples/12-testing.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"13-shared-entities",children:"13. Shared Entities"}),"\n",(0,s.jsx)(n.p,{children:"Mark entities shared across tenants with optional exclusions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"use Hakam\\MultiTenancyBundle\\Attribute\\TenantShared;\n\n#[TenantShared]\n#[ORM\\Entity]\nclass Plan { /* shared across ALL tenants */ }\n\n#[TenantShared(excludeTenants: ['free_tier'], group: 'premium')]\n#[ORM\\Entity]\nclass PremiumFeature { /* shared, but not for free_tier */ }\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Check access at runtime:\n$attr = (new \\ReflectionClass($entityClass))->getAttributes(TenantShared::class);\n$tenantShared = $attr[0]->newInstance();\n$canAccess = $tenantShared->isAvailableForTenant($currentTenantId);\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/13-shared-entities.php",children:(0,s.jsx)(n.code,{children:"examples/13-shared-entities.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"14-custom-resolver",children:"14. Custom Resolver"}),"\n",(0,s.jsxs)(n.p,{children:["Implement ",(0,s.jsx)(n.code,{children:"TenantResolverInterface"})," for custom resolution logic:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class JwtTenantResolver implements TenantResolverInterface\n{\n    public function resolve(Request $request): ?string\n    {\n        $token = substr($request->headers->get('Authorization', ''), 7);\n        $payload = json_decode(base64_decode(explode('.', $token)[1] ?? ''), true);\n        return $payload['tenant_id'] ?? null;\n    }\n\n    public function supports(Request $request): bool\n    {\n        return $request->headers->has('Authorization');\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/14-custom-resolver.php",children:(0,s.jsx)(n.code,{children:"examples/14-custom-resolver.php"})})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"15-full-onboarding-flow",children:"15. Full Onboarding Flow"}),"\n",(0,s.jsx)(n.p,{children:"Complete end-to-end tenant setup: config entity, create DB, migrate, load fixtures, verify:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"class TenantOnboardingService\n{\n    public function onboard(string $companyName, string $databaseName): array\n    {\n        // 1. Create config entity in main DB\n        $config = new TenantDbConfig();\n        $config->setDbName($databaseName);\n        $this->entityManager->persist($config);\n        $this->entityManager->flush();\n\n        // 2. Create the actual database\n        $this->tenantManager->createTenantDatabase($dto);\n        $this->tenantManager->updateTenantDatabaseStatus($id, DatabaseStatusEnum::DATABASE_CREATED);\n\n        // 3. Run migrations\n        $this->runCommand('tenant:migrations:migrate', ['type' => 'init', 'dbId' => $id]);\n\n        // 4. Load fixtures\n        $this->runCommand('tenant:fixtures:load', ['dbId' => $id, '--append' => true]);\n\n        return ['tenant_id' => $id, 'status' => 'ready'];\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["See full example: ",(0,s.jsx)(n.a,{href:"https://github.com/RamyHakam/multi_tenancy_bundle/blob/master/examples/15-full-onboarding-flow.php",children:(0,s.jsx)(n.code,{children:"examples/15-full-onboarding-flow.php"})})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>l});var a=t(6540);const s={},i=a.createContext(s);function r(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);